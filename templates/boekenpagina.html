<h2>Overzicht Boeken</h2>

<div class="toolbar">
  <div class="search-form">
    <input type="search" id="boeken-zoekbalk" name="zoek" placeholder="Zoek op titel of AVI..." value="{{.Zoekterm}}"
      autocomplete="off">
    <span class="search-reset" id="boeken-reset-btn">&times;</span>
  </div>
  <form action="/boek/toevoegen" method="post" class="add-form">
    <input type="text" name="titel" placeholder="Boektitel" required>
    <input type="text" name="avi_niveau" placeholder="AVI-niveau" required>
    <button type="submit">Boek Toevoegen</button>
  </form>
</div>

<div class="boeken-container" id="boeken-resultaten">
  <!-- AANPASSING: Gebruik $index om alleen de eerste 'details' te openen -->
  {{range $index, $groep := .AviGroepen}}
  <details class="avi-groep" {{if eq $index 0}}open{{end}}>
    <!-- AANPASSING: <h3> vervangen door <span> voor consistente stijl -->
    <summary><span>AVI-niveau: {{$groep.Niveau}}</span></summary>
    <div class="boeken-lijst">
      {{range $groep.Boeken}}
      <div class="boek-item">
        <span>{{.Titel}}</span>
        <form action="/boek/verwijderen/{{.ID}}" method="post"
          onsubmit="return confirm('Boek {{.Titel}} verwijderen?');">
          <button type="submit" class="delete-sm">X</button>
        </form>
      </div>
      {{end}}
    </div>
  </details>
  {{else}}
  <p>Geen boeken gevonden. Voeg een nieuw boek toe.</p>
  {{end}}
</div>

<!-- Het JavaScript-blok blijft ongewijzigd -->
<script>
  document.addEventListener('DOMContentLoaded', () => {
    const searchInput = document.getElementById('boeken-zoekbalk');
    const resetButton = document.getElementById('boeken-reset-btn');
    const resultsContainer = document.getElementById('boeken-resultaten');
    let debounceTimer;
    const performSearch = async () => {
      const query = searchInput.value;
      window.history.pushState({}, '', `/boeken?zoek=${encodeURIComponent(query)}`);
      try {
        const response = await fetch(`/boeken?zoek=${encodeURIComponent(query)}`);
        if (!response.ok) throw new Error('Netwerkrespons was niet ok.');
        const newHtml = await response.text();
        const parser = new DOMParser();
        const newDoc = parser.parseFromString(newHtml, 'text/html');
        const newResults = newDoc.getElementById('boeken-resultaten');
        if (newResults) {
          resultsContainer.innerHTML = newResults.innerHTML;
        }
      } catch (error) {
        console.error('Fout bij het ophalen van zoekresultaten:', error);
        resultsContainer.innerHTML = '<p>Er is een fout opgetreden bij het zoeken.</p>';
      }
    };
    const toggleResetButton = () => {
      resetButton.style.display = searchInput.value ? 'block' : 'none';
    };
    searchInput.addEventListener('keyup', () => {
      clearTimeout(debounceTimer);
      debounceTimer = setTimeout(performSearch, 300);
      toggleResetButton();
    });
    resetButton.addEventListener('click', () => {
      searchInput.value = '';
      toggleResetButton();
      performSearch();
    });
    toggleResetButton();
  });
</script>